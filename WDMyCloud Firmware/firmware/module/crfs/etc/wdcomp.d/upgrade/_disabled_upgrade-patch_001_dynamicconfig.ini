#!/bin/bash
# upgrade-patch_001_dynamicconfig.ini
#
# see also: /usr/bin/dpkg-maintscript-helper
##
logtag="patch"
logger -s -t "${logtag}" "$0"

## params supplied by settingsManager
filename="${1}"
PKG="${2}"
version_old="${3}"
version_new="${4}"
src_path="${5}"
tgt_path="${6}"
def_path="${7}"
upgradePath=$(dirname ${filename})

## source definitions
. ${upgradePath}/etc/system.conf 2>/dev/null
. ${upgradePath}/etc/nas/config/${PKG}.conf 2>/dev/null

## show params
logger -s -t "${logtag}" "filename=${filename}"
logger -s -t "${logtag}" "PKG=${PKG}"
logger -s -t "${logtag}" "src_path=${src_path}"
logger -s -t "${logtag}" "tgt_path=${tgt_path}"
logger -s -t "${logtag}" "def_path=${def_path}"
logger -s -t "${logtag}" "version_old=${version_old}"
logger -s -t "${logtag}" "version_new=${version_new}"

upgradeScript ( )
{
    logger -s -t "${logtag}" "upgrading \"${filename}\".."
    
    if [ "${version_old}" != "${version_new}" ]; then
        logger -s -t "${logtag}" "upgrading ${filename} from version ${version_old} to ${version_new}"
        logger -s -t "${logtag}" ".. the current action is to just copy the new default:"
        cp -avf "${def_path}" "${tgt_path}"
    else
        logger -s -t "${logtag}" "Error: expected old version to be less than new version"
    fi
    
    logger -s -t "${logtag}" "done."           
}

upgradeScript

exit 0

